{% extends "base.html" %}

{% block title %}JSON Beautifier - Developer Tools{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-100 mb-8">JSON Beautifier</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Input -->
        <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6">
            <h2 class="text-xl font-semibold text-gray-100 mb-4">Raw JSON Input</h2>
            <div class="space-y-4">
                <div>
                    <label for="json-input" class="block text-sm font-medium text-gray-300 mb-2">JSON to Beautify</label>
                    <textarea id="json-input" rows="20" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent font-mono text-sm" placeholder='{"key": "value", "nested": {"array": [1, 2, 3]}}'></textarea>
                </div>
                <div class="flex space-x-4">
                    <button onclick="beautifyJSON()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        Beautify JSON
                    </button>
                    <button onclick="minifyJSON()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        Minify JSON
                    </button>
                </div>
                <button onclick="clearInput()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                    Clear Input
                </button>
            </div>
        </div>

        <!-- Output -->
        <div class="bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6">
            <h2 class="text-xl font-semibold text-gray-100 mb-4">Formatted JSON Output</h2>
            <div class="space-y-4">
                <div>
                    <label for="json-output" class="block text-sm font-medium text-gray-300 mb-2">Beautified Result</label>
                    <textarea id="json-output" rows="20" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 font-mono text-sm" readonly placeholder="Beautified JSON will appear here..."></textarea>
                </div>
                <div class="flex space-x-4">
                    <button onclick="copyToClipboard('json-output')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        Copy Result
                    </button>
                    <button onclick="validateJSON()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                        Validate JSON
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JSON Info -->
    <div class="mt-6 bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6">
        <h3 class="text-lg font-semibold text-gray-100 mb-4">JSON Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="text-center p-4 bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-blue-400" id="char-count">0</div>
                <div class="text-sm text-gray-400">Characters</div>
            </div>
            <div class="text-center p-4 bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-green-400" id="line-count">0</div>
                <div class="text-sm text-gray-400">Lines</div>
            </div>
            <div class="text-center p-4 bg-gray-700 rounded-lg">
                <div class="text-2xl font-bold text-purple-400" id="size-bytes">0</div>
                <div class="text-sm text-gray-400">Bytes</div>
            </div>
        </div>
    </div>

    <!-- Error/Success Messages -->
    <div id="message" class="mt-4 hidden p-4 rounded-md"></div>
</div>

<script>
async function beautifyJSON() {
    const input = document.getElementById('json-input').value.trim();
    const output = document.getElementById('json-output');
    
    if (!input) {
        showMessage('Please enter JSON to beautify', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/json/beautify', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ json: input })
        });
        
        const data = await response.json();
        
        if (data.error) {
            showMessage('Invalid JSON: ' + data.error, 'error');
        } else {
            output.value = data.result;
            updateJSONInfo(data.result);
            showMessage('JSON beautified successfully', 'success');
        }
    } catch (error) {
        showMessage('Error beautifying JSON: ' + error.message, 'error');
    }
}

function minifyJSON() {
    const input = document.getElementById('json-input').value.trim();
    const output = document.getElementById('json-output');
    
    if (!input) {
        showMessage('Please enter JSON to minify', 'error');
        return;
    }
    
    try {
        const parsed = JSON.parse(input);
        const minified = JSON.stringify(parsed);
        output.value = minified;
        updateJSONInfo(minified);
        showMessage('JSON minified successfully', 'success');
    } catch (error) {
        showMessage('Invalid JSON: ' + error.message, 'error');
    }
}

function validateJSON() {
    const input = document.getElementById('json-input').value.trim();
    
    if (!input) {
        showMessage('Please enter JSON to validate', 'error');
        return;
    }
    
    try {
        JSON.parse(input);
        showMessage('✓ Valid JSON', 'success');
    } catch (error) {
        showMessage('✗ Invalid JSON: ' + error.message, 'error');
    }
}

function clearInput() {
    document.getElementById('json-input').value = '';
    document.getElementById('json-output').value = '';
    updateJSONInfo('');
}

function updateJSONInfo(text) {
    document.getElementById('char-count').textContent = text.length;
    document.getElementById('line-count').textContent = text ? text.split('\n').length : 0;
    document.getElementById('size-bytes').textContent = new Blob([text]).size;
}

function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    if (element.value) {
        navigator.clipboard.writeText(element.value);
        showMessage('Copied to clipboard', 'success');
    } else {
        showMessage('Nothing to copy', 'error');
    }
}

function showMessage(message, type) {
    const messageDiv = document.getElementById('message');
    messageDiv.className = `mt-4 p-4 rounded-md ${type === 'error' ? 'bg-red-900 text-red-100 border border-red-700' : 'bg-green-900 text-green-100 border border-green-700'}`;
    messageDiv.textContent = message;
    messageDiv.classList.remove('hidden');
    
    setTimeout(() => {
        messageDiv.classList.add('hidden');
    }, 3000);
}

// Update info on input change
document.getElementById('json-input').addEventListener('input', function() {
    updateJSONInfo(this.value);
});
</script>
{% endblock %}